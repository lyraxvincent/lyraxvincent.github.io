<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=content-type content="text/html"><meta name=viewport content="width=device-width,initial-scale=1"><title itemprop=name>Feature Engineering: deriving statistical features using pandas aggregate function | Vincent N.</title><meta property="og:title" content="Feature Engineering: deriving statistical features using pandas aggregate function | Vincent N."><meta name=twitter:title content="Feature Engineering: deriving statistical features using pandas aggregate function | Vincent N."><meta itemprop=name content="Feature Engineering: deriving statistical features using pandas aggregate function | Vincent N."><meta name=application-name content="Feature Engineering: deriving statistical features using pandas aggregate function | Vincent N."><meta property="og:site_name" content><meta name=description content="Portfolio website."><meta itemprop=description content="Portfolio website."><meta property="og:description" content="Portfolio website."><meta name=twitter:description content="Portfolio website."><meta property="og:locale" content="en"><meta name=language content="en"><meta itemprop=image content="https://lyraxvincent.github.io/"><meta property="og:image" content="https://lyraxvincent.github.io/"><meta name=twitter:image content="https://lyraxvincent.github.io/"><meta name=twitter:image:src content="https://lyraxvincent.github.io/"><meta name=generator content="Hugo 0.119.0"><link rel=canonical href=https://lyraxvincent.github.io/post/feature-engineering_-deriving-statistical-features-using-pandas-aggregate-function/><link href=/style.min.840eada6dfddec7b8ccfcf867f039bf80b1f16a265ec6e01dc553a3dddc9d509.css rel=stylesheet><link href=/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css rel=stylesheet><link rel=apple-touch-icon sizes=180x180 href=/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/icons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/icons/favicon-16x16.png><link rel=mask-icon href=/icons/safari-pinned-tab.svg><link rel="shortcut icon" href=/favicon.ico><link rel=manifest href=https://lyraxvincent.github.io/site.webmanifest><meta name=msapplication-config content="/browserconfig.xml"><meta name=msapplication-TileColor content="#2d89ef"><meta name=theme-color content="#434648"><link rel=icon type=image/svg+xml href=/icons/favicon.svg></head><body data-theme class=notransition><script src=/js/theme.min.8961c317c5b88b953fe27525839672c9343f1058ab044696ca225656c8ba2ab0.js integrity="sha256-iWHDF8W4i5U/4nUlg5ZyyTQ/EFirBEaWyiJWVsi6KrA="></script><div class=navbar role=navigation><nav class=menu aria-label="Main Navigation"><a href=https://lyraxvincent.github.io/ class=logo><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><title>Home</title><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></a><input type=checkbox id=menu-trigger class=menu-trigger>
<label for=menu-trigger><span class=menu-icon><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentcolor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7H3.40726"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M.5 12.5V1.5c0-.552285.447715-1 1-1h11C13.0523.5 13.5.947715 13.5 1.5v11C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C.947715 13.5.5 13.0523.5 12.5z"/></svg></span></label><div class=trigger><ul class=trigger-container><li><a class=menu-link href=/>Home</a></li><li><a class=menu-link href=/post/>Posts</a></li><li><a class=menu-link href=/about/>About</a></li><li class=menu-separator><span>|</span></li></ul><a id=mode href=#><svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg><svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg></a></div></nav></div><div class="wrapper post"><main class=page-content aria-label=Content><article><header class=header><h1 class=header-title>Feature Engineering: deriving statistical features using pandas aggregate function</h1><div class=post-meta><time datetime=2022-01-09T20:58:49+05:30 itemprop=datePublished>Jan 9, 2022</time></div></header><details class=toc><summary><b>Table of Contents</b></summary><nav id=TableOfContents></nav></details><div class=page-content><p align=center><img src=/img/blog/pandas_agg.png width=600 height=350 alt=png></p><p>Many times when dealing with anonymized or machine-generated datasets, you find yourself out of ideas to come up
with new features because it is unclear of what the dataset variables at hand represent. Take for example the
following dataframe:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=s2>&#34;../datasets/Updated_Test.csv&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>df</span><span class=p>[</span><span class=n>df</span><span class=o>.</span><span class=n>columns</span><span class=p>[</span><span class=mi>2</span><span class=p>:</span><span class=mi>13</span><span class=p>]]</span><span class=o>.</span><span class=n>head</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>data</span>
</span></span></code></pre></td></tr></table></div></div><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>absorbance0</th><th>absorbance1</th><th>absorbance2</th><th>absorbance3</th><th>absorbance4</th><th>absorbance5</th><th>absorbance6</th><th>absorbance7</th><th>absorbance8</th><th>absorbance9</th><th>absorbance10</th></tr></thead><tbody><tr><th>0</th><td>0.517951</td><td>0.520508</td><td>0.526852</td><td>0.531611</td><td>0.536816</td><td>0.543828</td><td>0.547761</td><td>0.554379</td><td>0.565622</td><td>0.575762</td><td>0.590253</td></tr><tr><th>1</th><td>0.517839</td><td>0.522367</td><td>0.525186</td><td>0.534661</td><td>0.541900</td><td>0.546180</td><td>0.551687</td><td>0.556753</td><td>0.566446</td><td>0.578208</td><td>0.591039</td></tr><tr><th>2</th><td>0.517702</td><td>0.522018</td><td>0.527237</td><td>0.534374</td><td>0.541155</td><td>0.547152</td><td>0.549837</td><td>0.557513</td><td>0.566793</td><td>0.580574</td><td>0.592258</td></tr><tr><th>3</th><td>0.525008</td><td>0.527439</td><td>0.536871</td><td>0.539636</td><td>0.546555</td><td>0.553183</td><td>0.558826</td><td>0.563549</td><td>0.575675</td><td>0.587214</td><td>0.597155</td></tr><tr><th>4</th><td>0.520532</td><td>0.522683</td><td>0.526842</td><td>0.534634</td><td>0.539676</td><td>0.547488</td><td>0.552688</td><td>0.558355</td><td>0.568959</td><td>0.578905</td><td>0.591207</td></tr><tr><th>5</th><td>0.526705</td><td>0.532114</td><td>0.536730</td><td>0.541363</td><td>0.549652</td><td>0.553074</td><td>0.558868</td><td>0.564017</td><td>0.576104</td><td>0.583493</td><td>0.598938</td></tr><tr><th>6</th><td>0.520870</td><td>0.531424</td><td>0.534101</td><td>0.538626</td><td>0.543272</td><td>0.551315</td><td>0.555033</td><td>0.563571</td><td>0.571861</td><td>0.583686</td><td>0.596506</td></tr><tr><th>7</th><td>0.527200</td><td>0.525328</td><td>0.532838</td><td>0.537154</td><td>0.543959</td><td>0.549961</td><td>0.557294</td><td>0.559478</td><td>0.572084</td><td>0.584293</td><td>0.597304</td></tr><tr><th>8</th><td>0.525830</td><td>0.532805</td><td>0.535670</td><td>0.539697</td><td>0.546112</td><td>0.551254</td><td>0.556557</td><td>0.564790</td><td>0.575007</td><td>0.583733</td><td>0.598626</td></tr><tr><th>9</th><td>0.533108</td><td>0.530202</td><td>0.537924</td><td>0.540190</td><td>0.548308</td><td>0.553694</td><td>0.558700</td><td>0.562952</td><td>0.574196</td><td>0.584925</td><td>0.597308</td></tr></tbody></table><p>This data is most probably machine generated, that is true because what we&rsquo;re seeing here is 10 rows of blood spectroscopy readings. (There are well over 150 absorbance columns but since our focus is on generating features let&rsquo;s just work with these 11 columns.)<br>We can use pandas aggregate function to map various statistical measures such as mean, median, variance etc of our data to come up with more features that can aid in improving our machine learning model performance when using this data in modeling a possible solution to the problem at hand. The modeling bit aside, for now let&rsquo;s dive straight to designing our extra features.<br>The various statistical measures we&rsquo;re going to aggregate are:</p><ul><li>mean</li><li>median</li><li>sum</li><li>count</li><li>max</li><li>min</li><li>standard deviation</li><li>variance</li><li>skewness</li><li>kurtosis</li></ul><p>Let&rsquo;s quickly wrap them all up in a loop:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># To avoid including an aggregated feature to calculations of another aggregated feature</span>
</span></span><span class=line><span class=cl><span class=c1># we create a list of features</span>
</span></span><span class=line><span class=cl><span class=n>features</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>columns</span><span class=o>.</span><span class=n>to_list</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Dataframe before adding aggregate features:</span><span class=se>\n\n</span><span class=s2>&#34;</span><span class=p>);</span> <span class=n>display</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>head</span><span class=p>(</span><span class=mi>3</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>funct</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;mean&#39;</span><span class=p>,</span> <span class=s1>&#39;median&#39;</span><span class=p>,</span> <span class=s1>&#39;sum&#39;</span><span class=p>,</span> <span class=s1>&#39;count&#39;</span><span class=p>,</span> <span class=s1>&#39;max&#39;</span><span class=p>,</span> <span class=s1>&#39;min&#39;</span><span class=p>,</span> <span class=s1>&#39;std&#39;</span><span class=p>,</span> <span class=s1>&#39;var&#39;</span><span class=p>,</span> <span class=s1>&#39;skew&#39;</span><span class=p>,</span> <span class=s1>&#39;kurt&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;agg_</span><span class=si>{</span><span class=n>funct</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>features</span><span class=p>]</span><span class=o>.</span><span class=n>agg</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>funct</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n\n</span><span class=s2>Dataframe after adding aggregate features:</span><span class=se>\n\n</span><span class=s2>&#34;</span><span class=p>);</span> <span class=n>display</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>head</span><span class=p>(</span><span class=mi>3</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>Dataframe before adding aggregate features:
</code></pre><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>absorbance0</th><th>absorbance1</th><th>absorbance2</th><th>absorbance3</th><th>absorbance4</th><th>absorbance5</th><th>absorbance6</th><th>absorbance7</th><th>absorbance8</th><th>absorbance9</th><th>absorbance10</th></tr></thead><tbody><tr><th>0</th><td>0.517951</td><td>0.520508</td><td>0.526852</td><td>0.531611</td><td>0.536816</td><td>0.543828</td><td>0.547761</td><td>0.554379</td><td>0.565622</td><td>0.575762</td><td>0.590253</td></tr><tr><th>1</th><td>0.517839</td><td>0.522367</td><td>0.525186</td><td>0.534661</td><td>0.541900</td><td>0.546180</td><td>0.551687</td><td>0.556753</td><td>0.566446</td><td>0.578208</td><td>0.591039</td></tr><tr><th>2</th><td>0.517702</td><td>0.522018</td><td>0.527237</td><td>0.534374</td><td>0.541155</td><td>0.547152</td><td>0.549837</td><td>0.557513</td><td>0.566793</td><td>0.580574</td><td>0.592258</td></tr></tbody></table><pre><code>Dataframe after adding aggregate features:
</code></pre><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>absorbance0</th><th>absorbance1</th><th>absorbance2</th><th>absorbance3</th><th>absorbance4</th><th>absorbance5</th><th>absorbance6</th><th>absorbance7</th><th>absorbance8</th><th>absorbance9</th><th>...</th><th>agg_mean</th><th>agg_median</th><th>agg_sum</th><th>agg_count</th><th>agg_max</th><th>agg_min</th><th>agg_std</th><th>agg_var</th><th>agg_skew</th><th>agg_kurt</th></tr></thead><tbody><tr><th>0</th><td>0.517951</td><td>0.520508</td><td>0.526852</td><td>0.531611</td><td>0.536816</td><td>0.543828</td><td>0.547761</td><td>0.554379</td><td>0.565622</td><td>0.575762</td><td>...</td><td>0.546486</td><td>0.543828</td><td>6.011343</td><td>11</td><td>0.590253</td><td>0.517951</td><td>0.023236</td><td>0.000540</td><td>0.622384</td><td>-0.477046</td></tr><tr><th>1</th><td>0.517839</td><td>0.522367</td><td>0.525186</td><td>0.534661</td><td>0.541900</td><td>0.546180</td><td>0.551687</td><td>0.556753</td><td>0.566446</td><td>0.578208</td><td>...</td><td>0.548388</td><td>0.546180</td><td>6.032264</td><td>11</td><td>0.591039</td><td>0.517839</td><td>0.023451</td><td>0.000550</td><td>0.465583</td><td>-0.609624</td></tr><tr><th>2</th><td>0.517702</td><td>0.522018</td><td>0.527237</td><td>0.534374</td><td>0.541155</td><td>0.547152</td><td>0.549837</td><td>0.557513</td><td>0.566793</td><td>0.580574</td><td>...</td><td>0.548783</td><td>0.547152</td><td>6.036613</td><td>11</td><td>0.592258</td><td>0.517702</td><td>0.023911</td><td>0.000572</td><td>0.520019</td><td>-0.569977</td></tr></tbody></table><p>3 rows Ã— 21 columns</p><p>Quick and efficient! We have added ten more features to our dataset.<br>Other function names that can be passed to pandas aggregate function are listed in the documentation <a href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.core.groupby.GroupBy.pipe.html#>here.</a> Note however that not all of them return a pandas series (column).</p></div></article></main></div><footer class=footer><span class=footer_item></span>&nbsp;<div class=footer_social-icons><a href=https://github.com/lyraxvincent target=_blank rel="noopener noreferrer me" title=Github><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a href=https://twitter.com/lyraxvincent target=_blank rel="noopener noreferrer me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a href=https://www.linkedin.com/in/vincent-njonge-528070178/ target=_blank rel="noopener noreferrer me" title=Linkedin><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a><a href=mailto:njongevincent@gmail.com target=_blank rel="noopener noreferrer me" title=Email><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 21" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a><a href=https://stackoverflow.com/users/11856808/lyrax target=_blank rel="noopener noreferrer me" title=Stackoverflow><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2.913 16.041v6.848h17.599v-6.848M7.16 18.696h8.925M7.65 13.937l8.675 1.8M9.214 9.124l8.058 3.758M12.086 4.65l6.849 5.66M15.774 1.111l5.313 7.162"/></svg></a></div></footer><a href=# title="Go to top" id=totop><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentcolor" stroke="currentcolor" viewBox="0 96 960 960"><path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197z"/></svg></a><script src=https://lyraxvincent.github.io/js/main.min.35f435a5d8eac613c52daa28d8af544a4512337d3e95236e4a4978417b8dcb2f.js integrity="sha256-NfQ1pdjqxhPFLaoo2K9USkUSM30+lSNuSkl4QXuNyy8="></script></body></html>